#!/bin/sh

set -e # DIE on errors

. /usr/share/dtc-xen/dtc-xen-parse-param

VPSNAME=${VPSNUM}


#################################
### VZ STARTUP FILE CREATION ###
#################################
if [ ! -z "${MAC_ADDR}" ] ; then
	XEN_WRITE_MAC="mac=${MAC_ADDR}, "
else
	XEN_WRITE_MAC=""
fi

echo -n "ONBOOT=\"yes\"
# Primary parameters
NUMPROC=\"1024:1024\"
NUMTCPSOCK=\"9223372036854775807:9223372036854775807\"
NUMOTHERSOCK=\"9223372036854775807:9223372036854775807\"
VMGUARPAGES=\"1048576:9223372036854775807\"

# Secondary parameters
KMEMSIZE=\"9223372036854775807:9223372036854775807\"
OOMGUARPAGES=\"1048576:9223372036854775807\"
PRIVVMPAGES=\"1048576:1061076\"
TCPSNDBUF=\"9223372036854775807:9223372036854775807\"
TCPRCVBUF=\"9223372036854775807:9223372036854775807\"
OTHERSOCKBUF=\"9223372036854775807:9223372036854775807\"
DGRAMRCVBUF=\"9223372036854775807:9223372036854775807\"

# Auxiliary parameters
NUMFILE=\"9223372036854775807:9223372036854775807\"
NUMFLOCK=\"9223372036854775807:9223372036854775807\"
NUMPTY=\"255:255\"
NUMSIGINFO=\"1024:1024\"
DCACHESIZE=\"9223372036854775807:9223372036854775807\"
LOCKEDPAGES=\"524288:524288\"
SHMPAGES=\"9223372036854775807:9223372036854775807\"
NUMIPTENT=\"9223372036854775807:9223372036854775807\"
PHYSPAGES=\"0:9223372036854775807\"

# Disk quota parameters
DISKSPACE=\"20971520:23068672\"
DISKINODES=\"4000000:4400000\"
QUOTATIME=\"0\"
QUOTAUGIDLIMIT=\"0\"

# CPU fair sheduler parameter
CPUUNITS=\"1000\"
CPUS=\"1\"
CPULIMIT=\"10\"
VE_ROOT=\"/var/lib/dtc-xen/mnt/${VPSNUM}\"
VE_PRIVATE=\"/var/lib/vz/private/${VPSNUM}\"
OSTEMPLATE=\"ubuntu-8.0-standard_8.04-1_i386\"
ORIGIN_SAMPLE=\"pve.auto\"
IP_ADDRESS=\"${FIRST_IP}\"
HOSTNAME=\"${VPS_FQDN}\"
DESCRIPTION=\"Dieguito<br><br>Ubuntu Hardy (standard)\"
NAMESERVER=\"${DNS}\"
SEARCHDOMAIN=\"servilinkweb.com.ar\"
NETIF=\"ifname=venet0,mac=${XEN_WRITE_MAC},host_mac=${XEN_WRITE_MAC}\"

" >/etc/vz/conf/${VPSNAME}
